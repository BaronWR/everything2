<node>
  <createtime>2009-11-18 20:42:11</createtime>
  <totalvotes>0</totalvotes>
  <node_id>1988802</node_id>
  <code>#jb says: security fixes

my $isGuest = $$USER{user_id} == $HTMLVARS{guest_user};

if ($isGuest) {

my $pass = $query-&gt;param(&quot;passwd&quot;);
$pass =~ s/./\*/g;
$query-&gt;param(&quot;passwd&quot;, $pass);

my $host = $ENV{HTTP_HOST} ;
$host =~ s/:\d+$// ;
$query-&gt;start_form(&quot;POST&quot;, 'http://'.$host.$query-&gt;script_name) .
$query-&gt;hidden(&quot;node_id&quot;, getId($NODE)) . &quot;\n&quot; .
$query-&gt;hidden(&quot;lastnode_id&quot;, $query-&gt;param(&quot;lastnode_id&quot;)) . &quot;\n&quot; .
'&lt;input type=&quot;hidden&quot; name=&quot;op&quot; value=&quot;login&quot; /&gt;

&lt;div&gt;Username: '. $query-&gt;textfield (-name =&gt; &quot;user&quot;, -size =&gt; 10, -maxlength =&gt; 20, -tabindex =&gt; 1).' &lt;strong&gt;Password&lt;/strong&gt; '.$query-&gt;password_field(-name =&gt; &quot;passwd&quot;, -size =&gt; 10, -maxlength =&gt; 10, -tabindex =&gt; 2) .
$query-&gt;submit(&quot;login&quot;, &quot;Login&quot;).' &lt;font size=&quot;2&quot;&gt;'.$query-&gt;checkbox(&quot;expires&quot;, &quot;&quot;, &quot;+10y&quot;, &quot;remember me&quot;) .&quot;&lt;/font&gt;&quot; .&quot;&lt;br /&gt;&quot;.
linkNodeTitle(&quot;What's my password?|password reminder&quot;).&quot; &quot;.linkNode($HTMLVARS{createNewUser_node},'register').&quot;\n&quot; .
$query-&gt;end_form.&quot;&lt;/div&gt;&quot;;

}
else {

	# Upon successful log-in, write current browser to VARS
	if ($query-&gt;param(&quot;op&quot;) eq &quot;login&quot;)
		{ $$VARS{browser} = $ENV{HTTP_USER_AGENT}; }

return &quot;&lt;div&gt;Welcome, &quot;.linkNode($USER).&quot; &quot;.linkNode($NODE, 'Log Out', {op=&gt;'logout'}).&quot;&lt;br /&gt;
You have 1 C! and 49 votes left.&lt;/div&gt;&quot;;

}
</code>
  <type_nodetype>4</type_nodetype>
  <title>e3 minilogin</title>
</node>
