<node>
  <doctext>It is a grim day such that you need to be here.  The slaughter of many have seen this altar, and many more will be sacrificed.  Many users choose to remove all of their writeups; so be it.  These writeups will be sent to heaven, instead of the crypt, so that there may be a second chance.  &lt;br&gt;&lt;br&gt;This simply lines up a really large killing floor page, and doesn't actually delete anything. The deleting process from there is the same. No more than a few hundred at a shot (POST data cannot handle more than that)&lt;br&gt;&lt;br&gt;

[%#'

my $str = '';

if($query-&gt;param('listforuser'))
{
    my $listuser = getNode($query-&gt;param('listforuser'), 'user');

  return 'There was no user: &quot;'.$query-&gt;param('user_name').'&quot; back to the '.linkNode($NODE, $$NODE{title}) unless($listuser);

  my $csr = $DB-&gt;getDatabaseHandle()-&gt;prepare('SELECT * FROM node WHERE type_nodetype=\'117\' AND author_user=\''.$$listuser{node_id}.'\' ORDER BY node_id');

  if($csr-&gt;execute())
  {
  
     my $row;

     while($row = $csr-&gt;fetchrow_hashref())
     {
          $str.=$$row{node_id}.&quot;&lt;br /&gt;&quot;;
     }
    
  }

  return $str;

}

if($query-&gt;param('user_name') &amp;&amp; $query-&gt;param('namelist'))
{

  my $names = $query-&gt;param('namelist');
my $uservictim = getNode($query-&gt;param('user_name'), 'user');

  return 'There was no user: &quot;'.$query-&gt;param('user_name').'&quot; back to the '.linkNode($NODE, $$NODE{title}) unless($uservictim);

  $names =~ s/\s+\n/\n/g;

  my @namelist = split('\n', $names);

  foreach my $parentnode (@namelist)
  {
     next unless($parentnode);
     my $wu = getNode($parentnode, 'e2node');
     $str.= &quot;&lt;li&gt; No such node: [$parentnode]&quot; unless($wu);

     next unless($wu);

     my $csr = $dbh-&gt;prepare('SELECT * FROM node LEFT JOIN writeup ON node.node_id = writeup.writeup_id where writeup.parent_e2node='.$$wu{node_id}.' AND node.author_user='.$$uservictim{node_id}.' ');

    $csr-&gt;execute();

    while(my $ROW = $csr-&gt;fetchrow_hashref())
    {
        $str .= '&lt;br /&gt;'.$$ROW{node_id};
    }

    $csr-&gt;finish();
  }

  return $str;

}

if($query-&gt;param('user_name') &amp;&amp; $query-&gt;param('idlist'))
{
  my $ids = $query-&gt;param('idlist');
  my $uservictim = getNode($query-&gt;param('user_name'), 'user');

  return 'There was no user: &quot;'.$query-&gt;param('user_name').'&quot; back to the '.linkNode($NODE, $$NODE{title}) unless($uservictim);

  $ids =~ s/\s+\n/\n/g;

  my @idlist = split('\n', $ids);
  my $tempid;

  $str.= '&lt;form method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;node_id&quot; value=&quot;1150966&quot;&gt;The following nodes by '.$$uservictim{title}.' are ready to be sent to the killing floor.  Nothing has happened to them yet.&lt;br&gt;&lt;ul&gt;';

  foreach my $wu (@idlist){

       next unless $wu;

       $tempid = getNodeById($wu);
     
       next unless $tempid;

       next unless $$tempid{type_nodetype} == 117;

       next unless $$tempid{author_user} == $$uservictim{node_id};

       $str.='&lt;li&gt;'.linkNode($tempid, $$tempid{title});

       $str.='&lt;input type=&quot;hidden&quot; name=&quot;op&quot; value=&quot;vote&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;nopain'.$$tempid{node_id}.'&quot; value=&quot;1&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;removenode'.$$tempid{node_id}.'&quot; value=&quot;1&quot;&gt;';

  }

  $str.= '&lt;br&gt;&lt;br&gt;&lt;INPUT TYPE=&quot;submit&quot; NAME=&quot;node&quot; VALUE=&quot;the killing floor II&quot;&gt;&lt;/ul&gt;&lt;/form&gt;';

}
else
{
$str ='
&lt;form method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;node_id&quot; value=&quot;1150966&quot;&gt;
The user\'s username:
&lt;input type=&quot;text&quot; name=&quot;user_name&quot;&gt;&lt;br&gt;
A list of the ids by that user.  Name is used here as a safety.&lt;br&gt;
&lt;textarea name=&quot;idlist&quot; ROWS=20 COLS=30&gt;&lt;/textarea&gt;&lt;br&gt;
&lt;input type=&quot;submit&quot; value=&quot;prepare the slaughter&quot;&gt;
&lt;/form&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;form method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;node_id&quot; value=&quot;1150966&quot;&gt;Generate an id list for a user:&lt;br&gt;&lt;input type=&quot;text&quot; name=&quot;listforuser&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;generate list&quot;&gt;&lt;/form&gt;&lt;Br&gt;&lt;br&gt;&lt;hr&gt;&lt;br&gt;&lt;form method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;node_id&quot; value=&quot;1150966&quot;&gt;
The user\'s username:
&lt;input type=&quot;text&quot; name=&quot;user_name&quot;&gt;&lt;br&gt;
A list of the names so that ids can be generated by that user.  (will be cleaned up eventually) Username is used here again as a safety.&lt;br&gt;
&lt;textarea name=&quot;namelist&quot; ROWS=20 COLS=30&gt;&lt;/textarea&gt;&lt;br&gt;
&lt;input type=&quot;submit&quot; value=&quot;get the ids of writeups&quot;&gt;
&lt;/form&gt;';
}

return $str;
%]</doctext>
  <core>0</core>
  <reputation>0</reputation>
  <lockedby_user>0</lockedby_user>
  <createtime>2001-09-03 03:56:04</createtime>
  <locktime>0000-00-00 00:00:00</locktime>
  <totalvotes>0</totalvotes>
  <hits>0</hits>
  <node_id>1150966</node_id>
  <edittime>0000-00-00 00:00:00</edittime>
  <type_nodetype>1144104</type_nodetype>
  <document_id>1150966</document_id>
  <author_user>459692</author_user>
  <package>0</package>
  <title>Altar of Sacrifice</title>
</node>
