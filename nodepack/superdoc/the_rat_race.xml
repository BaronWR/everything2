<node>
  <doctext>[%

my $sortbywu = $query-&gt;param(&quot;sortbywu&quot;);
$query-&gt;delete('sortbywu');
my $controls = htmlcode('openform') . $query-&gt;hidden('sortbywu', !$sortbywu);
if ($sortbywu) { $controls .= $query-&gt;submit('', 'sort by experience'); }
else { $controls .= $query-&gt;submit('', 'sort by writeups'); }
$controls .= $query-&gt;endform;

my $userreq = &quot;user_id &gt; 0&quot;;
my $rows = $dbh-&gt;prepare('SELECT DATE_ADD(CURDATE(), INTERVAL -1 YEAR)');
if ($rows &amp;&amp; $rows-&gt;execute()) {
	my $datestr = $rows-&gt;fetchrow_array();
	$userreq .= &quot; and lasttime &gt; '$datestr 00:00:00'&quot;;
}

my $above;
my $below;
if ($sortbywu) {
	$above = $DB-&gt;sqlSelectMany(&quot;user_id, experience, numwriteups&quot;, &quot;user&quot;, &quot;$userreq and numwriteups &gt; $$USER{numwriteups} order by numwriteups asc, experience asc limit 15&quot;);
	$below = $DB-&gt;sqlSelectMany(&quot;user_id, experience, numwriteups&quot;, &quot;user&quot;, &quot;$userreq and numwriteups &lt;= $$USER{numwriteups} order by numwriteups desc, experience desc limit 16&quot;);
} else {
	$above = $DB-&gt;sqlSelectMany(&quot;user_id, experience, numwriteups&quot;, &quot;user&quot;, &quot;$userreq and experience &gt; $$USER{experience} order by experience asc, numwriteups asc limit 15&quot;);
	$below = $DB-&gt;sqlSelectMany(&quot;user_id, experience, numwriteups&quot;, &quot;user&quot;, &quot;$userreq and experience &lt;= $$USER{experience} order by experience desc, numwriteups desc limit 16&quot;);
}

my $html = '';
my @revlist = ();
while (1) {
	my $nid;
	if ($above) {
		$nid = $above-&gt;fetchrow_hashref;
		if (!$nid) { $above = 0; }
	}
	if (!$above) {
		$nid = $below-&gt;fetchrow_hashref;
		if (!$nid) { last; }
	}
	my $node = getNodeById($nid-&gt;{user_id});
	my $name = '['.$$node{title}.'[user]]';
	my $exp = $$nid{experience};
	my $wri = $$nid{numwriteups};
	if ($nid-&gt;{user_id} == $$USER{node_id}) {
		$name = &quot;&lt;b&gt;$name&lt;/b&gt;&quot;;
		$exp = &quot;&lt;b&gt;$exp&lt;/b&gt;&quot;;
		$wri = &quot;&lt;b&gt;$wri&lt;/b&gt;&quot;;
	}
	my $line = &quot;&lt;tr&gt;&lt;td&gt;$name&lt;/td&gt;&lt;td&gt;$exp&lt;/td&gt;&lt;td&gt;$wri&lt;/td&gt;&lt;/tr&gt;\n&quot;;
	if ($above) { push @revlist, $line; }
	else { $html .= $line; }
}

@revlist = reverse @revlist;

&quot;&lt;br&gt; For those aspiring to [Everything's Best Users]&amp;mdash; &lt;br&gt;&lt;br&gt;
&quot; . $controls . &quot;
&lt;table class=\&quot;content\&quot;&gt;
&lt;tr&gt;&lt;th&gt;User&lt;/th&gt;&lt;th&gt;Experience&lt;/th&gt;&lt;th&gt;Writeups&lt;/th&gt;&lt;/tr&gt;
&quot; . (join '', @revlist) . $html . &quot;&lt;/table&gt;\n&quot;
. '(Not showing users inactive for a year or longer.)';

%]
</doctext>
  <createtime>2010-07-31 17:22:12</createtime>
  <totalvotes>0</totalvotes>
  <node_id>1990074</node_id>
  <edittime>0000-00-00 00:00:00</edittime>
  <type_nodetype>14</type_nodetype>
  <document_id>1990074</document_id>
  <author_user>1797883</author_user>
  <title>The Rat Race</title>
</node>
