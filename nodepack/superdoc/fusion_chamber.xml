<node>
  <doctext>[%
my $defaultTargetNode = 'tea bag';
my $targetNodeName = $query-&gt;param('targetNode') || $defaultTargetNode;
my $targetNode = getNode($targetNodeName, 'e2node');
my $targetNodeId = $$targetNode{node_id};

my $sessionId = htmlcode('getStarRatingSessionId');
my $condition = htmlcode('getStarRatingCondition');

my $rating = htmlcode('getStarRating', $targetNode);
my $ratingStr = (defined $rating ? $rating : &quot;(not yet set)&quot;);
my $avgRating = htmlcode('getAverageStarRating', $targetNode);
my $avgRatingStr = (defined $avgRating ? $avgRating : &quot;(not yet set)&quot;);

my $ratingDefault = (defined $rating ? $rating : 5);

my $str;

$str .= &quot;&lt;p&gt;Opcode debug: $HTMLVARS{'opcodedebug'}&lt;/p&gt;&quot;;

# Because of screwiness in ecore, you have to delete the op param
#  if you want to set it without manually typing out an input field
$query-&gt;delete_all();

$str .= htmlcode('openform', 'viewForm', 'GET');
$str .= &quot;&lt;p&gt;View node: &quot; 
  . $query-&gt;textfield('targetNode', $targetNodeName) . &quot;\n&quot;
  ;

$str .= $query-&gt;submit(&quot;view rating&quot;)
  . $query-&gt;end_form();

$str .= &quot;&lt;p&gt;Your session id is $sessionId.  Your condition is $condition.&lt;/p&gt;&quot;;

$str .= &quot;&lt;p id=\&quot;ratingStatus\&quot;&gt;&quot;;
$str .= &quot;Looking at node &quot; . linkNode($targetNode)
  . &quot; ($targetNodeId).  &quot;
  . &quot;Has star rating of ${ratingStr} with an average rating of ${avgRatingStr}.&quot;
  . &quot;&lt;/p&gt;&quot;
  ;

$str .= htmlcode('openform', 'rateForm', 'PUT');

$str .= &quot;Rate Node: &quot;
  . $query-&gt;hidden('targetNode', $targetNodeName) . &quot;\n&quot;
  . $query-&gt;hidden(-name =&gt; 'rating_node', -value =&gt; $targetNodeId) . &quot;\n&quot;
  . $query-&gt;hidden(-name =&gt; &quot;op&quot;, -value =&gt; &quot;starRate&quot;) . &quot;\n&quot;
  . htmlcode('verifyRequestForm', 'starrating') . &quot;\n&quot;
  . $query-&gt;popup_menu(
      -name =&gt; 'rating'
      , -values =&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
      , -default =&gt; $ratingDefault
      )
  . &quot;\n&quot;
  ;


$str .= $query-&gt;submit(&quot;set rating&quot;)
  . $query-&gt;end_form();

$str;
%]
</doctext>
  <node_id>1989083</node_id>
  <type_nodetype>14</type_nodetype>
  <title>Fusion Chamber</title>
</node>
