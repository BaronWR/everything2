<node>
  <doctext>[%
use File::Spec;
use File::stat;
my $file = getcwd(); 
my $abs_path = abs_path('/index.pl');
return stat($abs_path)-&gt;size;
%]

[{openform}]
&lt;p&gt;&lt;b&gt;My Writeup&lt;/b&gt; (note: clicking the submit button will not edit my writeup, so don't worry)&lt;br /&gt;
&lt;textarea name=&quot;mywriteup&quot; id=&quot;mywriteup&quot; rows=&quot;15&quot; style=&quot;width:100%&quot;&gt;
[%
my $str = '';
my $wu = getNodeById(1492501);
my $dbWriteupText = &quot;Pretend this is the writeup text that is stored in the database.

When you edit and submit this page, it will simulate editing one of your writeups.

For some reason, any HTML tag is being counted as a diff. I think this my be because after submitting, the characters might be different. This would obviously have to be worked out, but I don't have time to debug right now.

 * one 1
 * two 2
 * three 3&quot;;
my $dbWriteupText = $$wu{doctext};
my $submittedWriteupText = $query-&gt;param(&quot;mywriteup&quot;) . '';

if ($submittedWriteupText eq '')
{
   $str .= $dbWriteupText;
}
else
{
   $str .= $submittedWriteupText;
}
$str .= '&lt;/textarea&gt;
         &lt;input type=&quot;submit&quot; value=&quot;Edit Writeup&quot; /&gt;
         &lt;/form&gt;
         &lt;hr /&gt;';

use Algorithm::Diff qw(diff);

my @orig= split(/[ \n]/, $dbWriteupText);
my @rev = split(/[ \n]/, $submittedWriteupText);
my $diff = diff \@orig, \@rev;

my $shift = 0;

my $changeCtr = 0;
my $unchangedCtr = 0;
for my $hunk (@$diff)
{
    for my $change (@$hunk)
    {
        if ($change-&gt;[0] eq &quot;-&quot;)
        {
            # process deletions
            splice @orig, $change-&gt;[1] + $shift, 1;
            --$shift;
            $changeCtr++;
        }
        elsif ($change-&gt;[0] eq &quot;+&quot;)
        {
            # process additions
            splice @orig, $change-&gt;[1], 0, $change-&gt;[2];
            ++$shift;
            $changeCtr++;
        }
    }
}

$str .= '&lt;div style=&quot;border:1px solid #ccc;padding:3px;height:300px;overflow:auto&quot;&gt;ORIGINAL
&lt;pre&gt;' . $dbWriteupText . '&lt;/pre&gt;&lt;/div&gt;

&lt;div style=&quot;border:1px solid #ccc;padding:3px;height:300px;overflow:auto&quot;&gt;EDIT
&lt;pre&gt;'. $submittedWriteupText . '&lt;/pre&gt;&lt;/div&gt;';

my @origAgain = split(/[ \n]/, $dbWriteupText);
my @revAgain = split(/[ \n]/, $submittedWriteupText);
$str .= '&lt;p&gt;Total Items in Original: ' . scalar(@origAgain) . '&lt;br /&gt;
         Total Items in Edit: ' . scalar(@revAgain) . '&lt;br /&gt;
         Total Changes in Edit: ' . $changeCtr . '&lt;/p&gt;';


return $str;

%]</doctext>
  <createtime>2009-03-02 17:18:22</createtime>
  <totalvotes>0</totalvotes>
  <node_id>1976438</node_id>
  <edittime>0000-00-00 00:00:00</edittime>
  <type_nodetype>1065266</type_nodetype>
  <document_id>1976438</document_id>
  <author_user>1323377</author_user>
  <title>in10se's sandbox 5</title>
</node>
