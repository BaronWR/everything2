<node>
  <core>0</core>
  <reputation>0</reputation>
  <lockedby_user>0</lockedby_user>
  <createtime>2011-03-24 21:35:03</createtime>
  <locktime>0000-00-00 00:00:00</locktime>
  <totalvotes>0</totalvotes>
  <hits>0</hits>
  <node_id>1991740</node_id>
  <htmlcode_id>1991740</htmlcode_id>
  <checks_arguments>0</checks_arguments>
  <code>my $TYPE = getType('document');
return unless canCreateNode($USER, $TYPE);

my $nid = $query -&gt; param('node_id');
my $draft = getNodeById($nid);
return unless $draft &amp;&amp; $$draft{type}{title} eq 'draft';

return if getNode($$draft{title}, 'document');

$DB -&gt; sqlUpdate('node', {
		type_nodetype =&gt; $$TYPE{node_id}
		, -createtime =&gt; 'now()'
		, hits =&gt; 0
	}, &quot;node_id=$nid&quot;);
$DB -&gt; sqlDelete('draft', &quot;draft_id=$nid&quot;);

$DB -&gt; {cache} -&gt; incrementGlobalVersion($draft); # tell other processes this has changed...
$DB -&gt; {cache} -&gt; removeNode($draft); # and it's in the wrong typecache, so remove it

$query -&gt; delete('node');
$query -&gt; param('node_id', $nid);</code>
  <type_nodetype>415056</type_nodetype>
  <author_user>1828141</author_user>
  <package>0</package>
  <title>publishdrafttodocument</title>
</node>
